# コーディング環境の構築

フロントエンド開発において、コードの品質維持と標準化は常に課題となります。特にチーム開発では、一貫したコーディングスタイルと品質基準の統一が生産性向上の鍵となります。本ドキュメントでは、Next.jsプロジェクトでのスペルチェック、静的解析、構文チェック、コード整形などを自動化する設定について詳しく解説します。

## 実現できるコード品質管理

設定を行うことで以下の自動化機能が利用可能になります。

### スペルミスチェック

- 英単語のスペルミスの検知

### コード構造の自動整形

- インデントの統一（タブ幅2スペース）
- 適切な改行と空白の挿入
- 一貫したセミコロンの使用
- シングルクォーテーションの使用（`'` を優先）
- 末尾カンマの一貫した使用（ES5互換形式）

### インポート文の最適化

- インポート順序の自動整列（Node.js組み込みモジュール → 外部パッケージ → 内部モジュールなど）
- React関連パッケージの優先配置
- 各インポートグループ内でのアルファベット順ソート
- 不使用インポートの自動削除

### 静的解析によるコード品質チェック

- 未使用変数の検出と警告表示
- `var` 宣言の使用に対する警告（`let`/`const` を推奨）
- TypeScript固有の型チェックエラーの検出
- コーディング規約違反の自動検出

### スタイルコードの最適化

- Tailwind CSSクラス名の一貫した順序整理
- Tailwindのカスタムディレクティブのサポート（@apply, @tailwind など）

## 設定方法

### 1. スペルチェック機能を適用

拡張機能の Code Spell Checker をインストールします。  
これにより、スペルがミスしている文字にエラーが表示されるようになります。  
ただし、スペルミスではない単語もミスと判定されることがあるので、それを防ぐためプロジェクト直下に cspell.json を作成し、以下を記載します。

```
{
  "ignorePaths": ["**/.env"],
  "words": []
}
```

このファイルの words の配列に記載された文字列はスペルミスと判定されません。  
直接記載しても良いですが、エラーが出ているがスペルミスではない文字にフォーカスを当て、クイックフィックスから「Add: XXXXXXX to config: cspell.json」を選択することで、自動的に cspell.json に追加されます。

### 2. ESLint と Prettier の設定

!!!warning

    2025 年 5 月現在、Tailwind CSS のバージョン 4 が eslint-plugin-tailwindcss に対応していないため、package.json で tailwindcss のバージョンを"3.4.17"に修正し、設定を行ってください。

#### 拡張機能のインストール

VSCodeに以下の拡張機能をインストールします。

- ESLint
- Prettier - Code formatter

#### パッケージの設定

導入するパッケージは以下です。

| パッケージ名                       | 種別              | 主な役割                                                                                                 |
| ---------------------------------- | ----------------- | -------------------------------------------------------------------------------------------------------- |
| `eslint`                           | Linter            | JavaScript/TypeScript の静的解析（エラー・警告の検出）を行うLinterの本体。                               |
| `prettier`                         | フォーマッター    | 一貫したコード整形（インデントや改行、スペースなど）を行うツール。                                       |
| `eslint-config-prettier`           | ESLint 設定       | ESLint と Prettier の競合ルールを無効化（例: Prettier が整形したのに ESLint が怒らないようにする）。     |
| `eslint-plugin-import`             | ESLint プラグイン | import 文の構文や順序、解決パスの正しさなどを検証する。                                                  |
| `eslint-plugin-prettier`           | ESLint プラグイン | Prettier の整形結果を ESLint のエラーとして扱えるようにする（`plugin:prettier/recommended`で自動有効）。 |
| `eslint-plugin-tailwindcss`        | ESLint プラグイン | Tailwind CSS の class 名の並び順や冗長なクラスの指摘などを行う。                                         |
| `eslint-plugin-unused-imports`     | ESLint プラグイン | プロジェクト内に存在する 未使用のimport文や変数を検出し、自動で削除できるようにする。                    |
| `@eslint/compat`                   | ESLint プラグイン | ESLintの旧設定形式（.eslintrc系）を新形式（eslint.config.js）で利用可能にする互換性ライブラリ。          |
| `@typescript-eslint/eslint-plugin` | ESLint プラグイン | TypeScript コードに特化した追加ルールを提供（例: 明示的な型定義や型安全性のチェック）。                  |
| `@typescript-eslint/parser`        | ESLint 用パーサ   | TypeScript コードを ESLint で解析できるように変換する。ESLint は JS しか読めないためこれが必要。         |

以下のコマンドを実行します。

```
npm install -D eslint prettier eslint-config-prettier eslint-plugin-import eslint-plugin-prettier eslint-plugin-tailwindcss eslint-plugin-unused-imports @eslint/compat @typescript-eslint/eslint-plugin @typescript-eslint/parser
```

以下のファイルを作成します。

- eslint.config.mjs

ESLintのルールや動作を定義するファイルです。

```
import path from 'node:path';
import { fileURLToPath } from 'node:url';
import { fixupConfigRules, fixupPluginRules } from '@eslint/compat';
import { FlatCompat } from '@eslint/eslintrc';
import js from '@eslint/js';
import typescriptEslint from '@typescript-eslint/eslint-plugin';
import _import from 'eslint-plugin-import';
import prettier from 'eslint-plugin-prettier';
import unusedImports from 'eslint-plugin-unused-imports';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
const compat = new FlatCompat({
  baseDirectory: __dirname,
  recommendedConfig: js.configs.recommended,
  allConfig: js.configs.all,
});

const eslintConfig = [
  // 特定のディレクトリをESLintのチェック対象から除外
  {
    ignores: ['**/public/'],
  },
  ...fixupConfigRules(
    compat.extends(
      // Next.jsのパフォーマンス関連推奨設定
      'next/core-web-vitals',
      // import関連のエラールール
      'plugin:import/errors',
      // TypeScriptのimport設定
      'plugin:import/typescript',
      // import関連の警告ルール
      'plugin:import/warnings',
      // TailwindCSS推奨設定
      'plugin:tailwindcss/recommended',
      // TypeScript推奨設定
      'plugin:@typescript-eslint/recommended'
    )
  ),
  {
    // 使用するプラグインを登録
    plugins: {
      // TypeScript用プラグイン
      '@typescript-eslint': fixupPluginRules(typescriptEslint),
      // インポート順序などを管理するプラグイン
      import: fixupPluginRules(_import),
      // 未使用インポートを検出するプラグイン
      'unused-imports': unusedImports,
      // Prettierとの連携プラグイン
      prettier,
    },

    // プラグイン固有の設定
    settings: {
      'import/resolver': {
        typescript: {},
      },
    },

    // 個別のルール設定
    rules: {
      // インポート順序のルール - ファイル保存時に自動的にインポート文が整理される
      'import/order': [
        'warn', // 違反時は警告のみ
        {
          // インポートグループの順序定義
          groups: [
            'builtin', // Node.js組み込みモジュール (fs, path等)
            'external', // npm パッケージ
            'internal', // プロジェクト内の内部モジュール
            'parent', // 親ディレクトリのモジュール (../ で始まる)
            'sibling', // 同じディレクトリのモジュール (./ で始まる)
            'index', // 現在のディレクトリのindex
            'object', // オブジェクトインポート
            'type', // 型のみのインポート
          ],

          // 特定のパターンに一致するインポートのグループと位置を指定
          pathGroups: [
            {
              // Reactとその関連パッケージを最初にインポートするよう設定
              pattern: '{react,react-dom/**,react-router-dom}',
              group: 'builtin', // builtin グループに分類
              position: 'before', // グループの先頭に配置
            },
          ],

          // 特定のインポートタイプをpathGroupsから除外
          pathGroupsExcludedImportTypes: ['builtin'],

          // 各グループ内でアルファベット順にソート
          alphabetize: {
            order: 'asc', // 昇順
            caseInsensitive: true, // 大文字小文字を区別しない
          },
        },
      ],

      // 未使用の変数に警告を出す（TypeScript用）
      '@typescript-eslint/no-unused-vars': 'warn',
      // 未使用のインポートに警告を出す - ファイル保存時に自動的に削除される
      'unused-imports/no-unused-imports': 'warn',
      // React Hooksの依存関係チェックを無効化
      'react-hooks/exhaustive-deps': 'off',
      // var文の使用に警告を出す（let/constを推奨）
      'no-var': 'warn',
      // Prettierのスタイルルール違反に警告を出す
      'prettier/prettier': 'warn',
    },
  },
];

export default eslintConfig;
```

- .prettierrc

Prettierの整形ルールを定義するファイルです。  
それぞれ以下の機能を設定します。

- ステートメントの末尾にセミコロンを付ける
- シングルクォートを使う
- インデント幅をスペース2つ分にする
- ES5で許される箇所には末尾カンマをつける

```
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "es5",
}
```

- .prettierignore

Prettierで処理の対象外にするファイルやディレクトリを指定するファイルです。

```
node_modules
.next
```

### 3. VSCodeの設定

.vscode/settings.jsonを作成し、以下を追記します。

```
{
  // ファイル保存時に自動的にフォーマットする
  "editor.formatOnSave": true,
  // フォーマッターを指定
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  // ファイル保存時に自動的にLintを実行
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },
  // CSSファイルをTailwindCSSとして認識
  "files.associations": {
    "*.css": "tailwindcss"
  },
  // ESLintの設定を使用
  "eslint.useFlatConfig": true,
  // ESLintでバリデーションを行うファイルタイプを指定
  "eslint.validate": [
    "javascript",
    "javascriptreact",
    "typescript",
    "typescriptreact"
  ]
}
```

## 動作確認

設定が完了したら、一度VSCodeを完全に終了してください。  
その後再度VSCodeを開き、以下のコマンドを実行することでLintを実行し、プロジェクト内の警告を表示することができます。

```
npm run lint
```

src/app/layout.tsxなどを開いて警告が表示され、ファイル保存で警告が全て自動修正されたら問題なく設定が反映されています。
